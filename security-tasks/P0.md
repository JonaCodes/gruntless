# P0: Critical Security Issues

---

## 1. FIXED ~Missing Authorization in Share Creation~

---

## 2. Rate Limiting Not Applied

**Files:** `server/server.ts`, `server/middleware/rate-limiter.ts`

**Issue:** Rate limiter is defined but never applied to routes.

**Why Dangerous:** API vulnerable to brute force attacks (share code guessing),
DDoS, spam, and resource exhaustion.

**Solution:** Add `app.use(globalRateLimiter)` in server.ts before route
definitions.

---

## 3. No CSRF Protection

**Files:** `server/server.ts`

**Issue:** No CSRF middleware installed for state-changing endpoints.

**Why Dangerous:** Malicious sites can trick logged-in users into performing
unwanted actions (accepting shares, creating workflows).

**Solution:** Current auth uses JWT in header (not cookies), which mitigates
CSRF. Document this as a security requirement and ensure cookies are never added
without implementing CSRF protection. Optionally install `csurf` if cookies are
needed.

---

## 4. No Security Headers

**Files:** `server/server.ts`

**Issue:** Missing helmet middleware - no CSP, X-Frame-Options, HSTS, etc.

**Why Dangerous:**

- No XSS protection from CSP
- Vulnerable to clickjacking (iframe embedding)
- No HTTPS enforcement
- MIME sniffing attacks possible

**Solution:** Install `helmet` package and add `app.use(helmet())` in server.ts.

---

## 5. No File Type Validation

**Files:** `server/services/supabase/storageService.ts`

**Issue:** Server trusts client-provided MIME type without verification. No
magic byte checking or extension whitelist.

**Why Dangerous:** Users could upload malicious executables (.exe, .sh)
disguised as CSV files.

**Solution:**

1. Whitelist allowed extensions and MIME types
2. Install `file-type` package to verify actual file type via magic bytes
3. Reject files that don't match whitelist

---

## 6. No File Size Limits

**Files:** `server/server.ts`, client Dropzone components

**Issue:** No size limits configured on server or client.

**Why Dangerous:** Memory exhaustion, bandwidth abuse, storage quota depletion
from uploading huge files.

**Solution:**

- Server: `app.use(express.json({ limit: '10mb' }))`
- Client: Add `maxSize={10 * 1024 * 1024}` prop to Dropzone components

---

## 7. SQL Injection Risk

**Files:** `server/services/workflows/workflowsService.ts:18-27`

**Issue:** String interpolation in SQL literal instead of parameterized queries:

```typescript
where: literal(`"Workflow"."user_id" = ${userId}`);
```

**Why Dangerous:** If authentication is bypassed or userId source compromised,
becomes SQL injection vector. Also sets bad pattern.

**Solution:** Use Sequelize replacements:

```typescript
where: literal(`"Workflow"."user_id" = :userId`, { replacements: { userId } });
```

---

## 8. No Input Sanitization (XSS)

**Files:** `server/controllers/workflowsController.ts`

**Issue:** User inputs (workflow name, description, labels, etc.) stored without
sanitization.

**Why Dangerous:** Stored XSS attacks. Malicious users can inject `<script>`
tags that execute when other users view the workflow.

**Solution:** Install `dompurify` and sanitize all text inputs before storing:

```typescript
const sanitized = DOMPurify.sanitize(userInput, { ALLOWED_TAGS: [] });
```
